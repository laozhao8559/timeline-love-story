# 时间轴彩蛋配置说明

## 功能概述

时间轴滚动到最后一个节点 80% 可见，且停留 3 秒后，会自动触发四阶段彩蛋动画：

### 🎬 动画流程

| 阶段 | 效果 | 时长 |
|------|------|------|
| 1️⃣ 世界安静 | 背景变暗、时间轴缩小、音乐降低、显示"故事还没有结束" | 1.5 秒 |
| 2️⃣ 回忆闪回 | 照片快速淡入淡出 OR 文字打字效果 | 3-5 秒 |
| 3️⃣ 终极文字 | 显示核心表白文字 + 生日祝福 | 约 5 秒 |
| 4️⃣ 继续按钮 | 显示"继续写下去"按钮，点击添加未来节点 | - |

---

## ⚙️ 配置方法

### 1. 编辑配置文件

打开 `js/easter-egg.js`，找到 `EASTER_EGG_CONFIG` 配置对象：

```javascript
const EASTER_EGG_CONFIG = {
  // 触发阈值（最后一个节点可见比例）
  triggerThreshold: 0.8,

  // 需要停留的时间（毫秒）
  stayDuration: 3000,

  // 方案选择：'photos'（照片模式） 或 'text'（文字模式）
  stage2Mode: 'photos',

  // 照片数据（使用 IndexedDB 引用或直接 URL）
  photos: [
    // TODO: 在这里添加照片
    // 示例：'indexeddb:img_xxx' 或 'https://example.com/photo.jpg'
  ],

  // 文字数据（当 stage2Mode = 'text' 时使用）
  texts: [
    '是你，让日子有了重量',
    '是你，让时间变得温柔',
    '是你，让我有了家'
  ],

  // 每张照片显示时长（毫秒）
  photoDuration: 600,

  // 打字速度（每字毫秒）
  typingSpeed: 100
};
```

### 2. 照片模式配置

#### 方法 A：使用编辑器上传的照片（推荐）

1. 在编辑器中上传照片到任何节点
2. 打开浏览器控制台（F12 → Console）
3. 输入以下命令查看已上传照片的 ID：

```javascript
// 查看所有已上传的照片 IndexedDB 引用
console.log(JSON.stringify(
  JSON.parse(localStorage.getItem('timeline_data'))
    .flatMap(n => n.contents)
    .filter(c => c.type === 'image' && c.src.startsWith('indexeddb:'))
    .map(c => c.src)
));
```

4. 复制输出的 `indexeddb:img_xxx` 格式的 ID，添加到 `photos` 数组

#### 方法 B：使用外部图片 URL

直接在 `photos` 数组中添加图片 URL：

```javascript
photos: [
  'https://example.com/photo1.jpg',
  'https://example.com/photo2.jpg',
  // ...
]
```

### 3. 文字模式配置

将 `stage2Mode` 改为 `'text'`，并编辑 `texts` 数组：

```javascript
stage2Mode: 'text',
texts: [
  '是你，让日子有了重量',
  '是你，让时间变得温柔',
  '是你，让我有了家'
],
```

---

## 🧪 测试方法

### 快速触发测试

1. 打开 `editor.html`，进入阅读模式
2. 滚动到最后一个节点附近
3. 等待 3 秒，彩蛋会自动触发

### 重置彩蛋状态

如果需要重复测试，在控制台输入：

```javascript
resetEasterEgg()
```

### 调整触发参数

- `triggerThreshold: 0.8` → 改为 `0.5` 可以更快触发（50% 可见即触发）
- `stayDuration: 3000` → 改为 `1000` 可以减少等待时间（1 秒）

---

## 📝 自定义文字

### 修改阶段 3 终极文字

编辑 `js/easter-egg.js` 中的 `runStage3_FinalWords` 函数：

```javascript
typeWriter('final-line-1', '这不是一个网页。\n这是我想陪你走完的这一生。', 80, () => {
  setTimeout(() => {
    typeWriter('final-line-2', '生日快乐，我的爱人。', 120, () => {
      // ...
    });
  }, 1000);
});
```

### 修改"继续写下去"按钮文字

编辑 `runStage4_ContinueButton` 函数：

```javascript
button.innerHTML = '<span class="btn-text">继续写下去</span><span class="btn-sparkle">✨</span>';
```

### 修改未来节点内容

编辑 `addFutureNode` 函数：

```javascript
newNode.innerHTML = `
  <div class="timeline-date">未来</div>
  <div class="timeline-content">
    <h3 class="timeline-title">未完待续…</h3>
    ...
  </div>
`;
```

---

## 💡 建议

### 照片选择建议

- **5-8 张**为最佳数量（太多会拖慢节奏）
- 建议：你们的合照 + 女儿照片混合
- **重要**：中间插入一张你老婆的单人照片

### 文字选择建议

- **3-4 句**刚好（不要太多）
- 短小精悍，有画面感
- 示例：
  - "是你，让日子有了重量"
  - "是你，让时间变得温柔"
  - "是你，让我有了家"

---

## 🎨 样式自定义

如需修改颜色、字体等样式，编辑 `css/animations.css` 中 `/* Easter Egg Animations */` 部分。

---

## ⚠️ 注意事项

1. 照片使用 IndexedDB 存储时，导出 HTML 时需要确保照片已转为 base64
2. 编辑器模式下不会触发彩蛋（避免干扰编辑）
3. 彩蛋只会触发一次，刷新页面后可再次触发
